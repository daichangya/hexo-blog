---
title: ä»€ä¹ˆæ˜¯MVEL?
id: 1581
date: 2024-10-31 22:02:02
author: daichangya
permalink: /archives/%E4%BB%80%E4%B9%88%E6%98%AFmvel/
tags: 
 - è¡¨è¾¾å¼
---


### 1.MVELæ˜¯å•¥ï¼Ÿå®ƒèƒ½åšå•¥ï¼Ÿ

ç®€å•æ¥è¯´æ˜¯ä¸€ç§å¼ºå¤§çš„è¡¨è¾¾å¼è§£æå™¨ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±å†™ä¸€äº›è¡¨è¾¾å¼ï¼Œäº¤ç»™mvelè¿›è¡Œè§£æè®¡ç®—ï¼Œå¾—åˆ°è¿™ä¸ªè¡¨è¾¾å¼è®¡ç®—çš„å€¼ã€‚ç©æ¦‚å¿µï¼Œæˆ‘ä¸æ‡‚ï¼ŒğŸ˜¢

è¿˜æ˜¯ä¸¾ä¸ªä¾‹å­é è°±ã€‚ğŸ‘  
æ¯”å¦‚æˆ‘ä»¬è¦è¿›è¡Œä¸€ä¸ªåŠ æ³•è¿ç®—ã€‚åœ¨javaä¸­æˆ‘ä»¬è¿™æ ·å†™ï¼š

```
int res = 1+1;  // 2

```

è‹¥æˆ‘ç”¨mvelåˆ™è¿™æ ·å†™ï¼š

```
Object res = MVEL.eval("1+1");  //2

```

æ˜¯ä¸æ˜¯å¾ˆåƒæƒŠğŸ˜±ã€‚â€œ1+1â€å°±æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç¬¬ä¸€ç§æˆ‘ä»¬æ˜¯ç¡¬ç¼–ç å®ç°çš„è®¡ç®—ç»“æœï¼Œä½†æ˜¯ç¬¬äºŒç§æ–¹æ¡ˆï¼Œç›´æ¥ç»™evelå‡½æ•°ä¼ é€’ä¸€ä¸ªè¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œç›´æ¥èƒ½è®¡ç®—å‡ºç»“æœã€‚è¿™æ ·å¦‚æœæƒ³è®¡ç®—1-1ã€‚ç›´æ¥ä¼ äººä¸åŒçš„è¡¨è¾¾å¼å³å¯ã€‚ç°åœ¨è¦è®¡ç®—'(2+2)*3+5/2'æˆ–'2>1?1+1:2+2'ã€‚æ¥å§ä½ ç¡¬ç¼–ç è¯•è¯•è¿™äº›è®¡ç®—ï¼Ÿæ˜¯ä¸æ˜¯åˆè¦å¤šå†™å‡ è¡Œä»£ç ï¼Œè€Œä¸”ä¸ä¾¿æ‰©å±•ã€‚

ä½ ä»¥ä¸ºmvelåªèƒ½åšè¿™äº›äº†ï¼Ÿé‚£å°±çœŸçš„æ˜¯å¤ªå¹´è½»äº†ã€‚ç›®å‰mvelæ”¯æŒå¤§é‡çš„è¯­æ³•ï¼Œæ¡ä»¶ï¼Œå¾ªç¯ç­‰ã€‚è¿˜å¯ä»¥æ”¯æŒè‡ªå®šä¹‰å‡½æ•°ï¼Œè¿™å°±ğŸ‚äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬å·¥ä½œä¸­ç”¨è¿™ä¸œè¥¿æ¥å¹²å˜›ï¼Ÿ

### 2.åœ¨è‡ªå®šä¹‰æ•°æ®æµè½¬ä¸­çš„ä½¿ç”¨

#### â‘  å•¥æ˜¯æ•°æ®æµè½¬

æ•°æ®æµè½¬å°±æ˜¯ä¸åŒå¯¹è±¡é—´æ•°æ®çš„è½¬æ¢ã€‚æ¯”å¦‚aå¯¹è±¡æ•°æ®é€šè¿‡æŸäº›è§„åˆ™è½¬åŒ–ä¸ºbå¯¹è±¡æ•°æ®ã€‚caï¼Œè¿™è¯´çš„æ˜¯ä¸æ˜¯æ•°æ®æ¸…æ´—ï¼Ÿï¼Ÿï¼Ÿã€‚å¯¹ï¼Œè¯´çš„æ²¡é”™ï¼Œä½†æ˜¯æ•°æ®æ¸…æ´—åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå…·ä½“é¡¹ç½¢äº†ã€‚ğŸ‘ï¼Œæ¥ä¸ªå›¾ï¼š  
![](https://oscimg.oschina.net/oscnet/391bba8cf95500a2b9d89a94d09888dcace.jpg)

ç”±å›¾å¯ä»¥çœ‹å‡ºä¸¤ä¸ªå¯¹è±¡nameå’Œageéƒ½æ˜¯ä¸€å¯¹ä¸€æ˜ å°„ï¼Œä½†æ˜¯ç›®æ ‡å¯¹è±¡ä¸éœ€è¦sexå­—æ®µï¼Œä½†æ˜¯å¤šäº†ä¸€ä¸ªå‡ºç”Ÿå¹´çš„å­—æ®µï¼Œè€Œä¸”æ˜¯é€šè¿‡å¹´é¾„è®¡ç®—è€Œæ¥ã€‚ä¸‹é¢æˆ‘ä»¬å°±ä»¥ä»£ç æ¥æ¨¡æ‹Ÿä¸€ä¸‹è¿™ä¸ªè½¬æ¢è¿‡ç¨‹,åœ¨è¿™é‡Œæˆ‘å¯¹è±¡éƒ½ç”¨mapæ¥å®šä¹‰ã€‚

```
HashMap<Object, Object> srcMap = Maps.newHashMap();
srcMap.put("name","zs");
srcMap.put("age",10);
srcMap.put("sex","å¥³");
//å­—æ®µæ˜ å°„å…³ç³»
HashMap<String, String> mapping = Maps.newHashMap();
mapping.put("name","name");
mapping.put("age","age");
//è¿™é‡Œå…ˆæŠŠå½“å‰å¹´ä»½å†™æ­»ä¸º2019
mapping.put("birthYear","2019-age");
//ç›®æ ‡å¯¹è±¡
HashMap<Object, Object> targetMap = Maps.newHashMap();
//kä¸ºç›®æ ‡è¡¨å­—æ®µï¼Œvä¸ºè½¬æ¢è§„åˆ™
mapping.forEach((k,v)->{
    Object reValue = MVEL.eval(v,srcMap);
    targetMap.put(k,reValue);
});
System.out.println("æºå¯¹è±¡"+srcMap);    //æºå¯¹è±¡{sex=å¥³, name=zs, age=10}
System.out.println("ç›®æ ‡å¯¹è±¡"+targetMap);   //ç›®æ ‡å¯¹è±¡{birthYear=2009, name=zs, age=10}

```

å¯¹å°±è¿™ä¹ˆç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œè®¡ç®—å‡ºç”Ÿå¹´ä»½ä¸­çš„å½“å‰å¹´ä»½å†™æ­»äº†å•Šã€‚æ˜ç»†ä¸ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ²¡äº‹æˆ‘ä»¬æ…¢æ…¢æ¥ã€‚

.è‡ªå®šä¹‰å‡½æ•°

å®šä¹‰è·å–å½“å‰å¹´ä»½å‡½æ•°

```
/**
 * è·å–å½“å‰å¹´ä»½æ–¹æ³•
 * @return
 */
public static Object getCurrentYear(){
    Calendar date = Calendar.getInstance();
    String year = String.valueOf(date.get(Calendar.YEAR));
    return year;
}

```

.å°†è‡ªå®šä¹‰å‡½æ•°æ³¨å†Œ

ç›´æ¥ä¸Šä»£ç 

```
static ParserContext context = new ParserContext();
static {
    //MvelTestæ˜¯getCurrentYearå‡½æ•°çš„ç±»
    Method[] declaredMethods = MvelTest.class.getDeclaredMethods();
    for(Method method : declaredMethods){
        context.addImport(method.getName(),method);
    }
}

```

.ä½¿ç”¨

ç›´æ¥å°†Object reValue = MVEL.eval(v,srcMap);æ›¿æ¢ä¸º

```
Object reValue = MVEL.executeExpression(MVEL.compileExpression(v, context),srcMap);

```

å³å¯ã€‚compileExpressionçš„ä½œç”¨å°±æ˜¯å°†æˆ‘ä»¬çš„è§„åˆ™è¿›è¡Œç¼–è¯‘æˆmvelå¯ä»¥è¯†åˆ«çš„ä¸€ä¸ªè¿‡ç¨‹

birthYearè§„åˆ™æ›¿æ¢ä¸ºmapping.put("birthYear","getCurrentYear()-age");æ‰§è¡Œå¾—åˆ°ç›¸åŒçš„ç»“æœã€‚

æœ‰äº†è¿™äº›æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ›´å¤šçš„è½¬æ¢è§„åˆ™ï¼Œè¿˜å¯ä»¥å€Ÿæ­¤å¼€å‘ä¸€å¥—ç”¨æˆ·é…ç½®å·¥å…·ï¼Œæ ¹æ®ç”¨æˆ·è‡ªå·±çš„é…ç½®ï¼Œè¿›è¡Œç›¸åº”çš„èµ„æºæ˜ å°„ã€‚å¾—åˆ°æƒ³è¦çš„ç›®æ ‡æ•°æ®ã€‚

### 3.å°ç»“

è¿™é‡Œåªæ˜¯åœ¨å·¥ä½œä¸­ç”¨åˆ°mvelçš„ä¸€ä¸ªå°å°çš„å°è¯•ã€‚æ›´å¤šçš„ç ”ç©¶åç»­è¿›è¡Œã€‚